---
slug: discordjs-command-handler1
title: å¦‚ä½•ç”¨discord.jså»ºç«‹ä¸€å€‹æŒ‡ä»¤ç³»çµ±
authors: [kay]
description: "æ­¤æ–‡ç« æœƒç”±Wolf Yuanå…ˆå‰å»ºç«‹çš„ã€Œä½¿ç”¨ discord.js å¿«é€Ÿå»ºç«‹ä¸€å€‹ Discord éª°å­æ©Ÿå™¨äººã€å»¶ä¼¸ï¼Œæœƒæ•™å¤§å®¶ç°¡å–®ä»¶è£¡èµ·ä¸€å€‹æŒ‡ä»¤ç³»çµ±ï¼Œè®“ç®¡ç†æŒ‡ä»¤æ›´æ–¹ä¾¿"
tags:
  [
    "Discord",
    "dc",
    "æ©Ÿå™¨äºº",
    "æŒ‡ä»¤",
    "æŒ‡ä»¤ç³»çµ±",
    "command",
    "commandHanlder",
    "discordjs",
    "discord.js",
  ]
date: 2022-06-27T17:08:17
---
import SyntaxHighlighter from "react-syntax-highlighter";
import { dracula } from "react-syntax-highlighter/dist/esm/styles/hljs";

# å¦‚ä½•ç”¨discord.jså»ºç«‹ä¸€å€‹æŒ‡ä»¤ç³»çµ±

æ­¤æ–‡ç« æœƒå¾Wolf Yuanå…ˆå‰å»ºç«‹çš„ã€Œä½¿ç”¨ discord.js å¿«é€Ÿå»ºç«‹ä¸€å€‹ Discord éª°å­æ©Ÿå™¨äººã€æ–‡ç« ç¨‹å¼ç¢¼å»¶ä¼¸ï¼Œæ•™å¤§å®¶ç°¡å–®å»ºç«‹ä¸€å€‹æŒ‡ä»¤ç³»çµ±ï¼Œè®“ç®¡ç†æŒ‡ä»¤æ›´æ–¹ä¾¿
:::warning
1. æ­¤æ•™å­¸æœƒå¾[ä½¿ç”¨ discord.js å¿«é€Ÿå»ºç«‹ä¸€å€‹ Discord éª°å­æ©Ÿå™¨äºº](https://yeecord.com/blog/discordjs-dice-bot/)æ–‡ç« çš„ç¨‹å¼ç¢¼é€²è¡Œå»¶ä¼¸ï¼Œå¦‚æœæ‚¨æ˜¯ä¸€å€‹discord.jsæ–°æ‰‹ï¼Œä¸¦ä¸”å°æ­¤æ–‡ç« è¦ä¿®æ”¹ï¼ˆä¸å«æ’°å¯«ï¼‰çš„ç¨‹å¼ç¢¼æ„Ÿåˆ°é™Œç”Ÿè€…ï¼Œè«‹å…ˆé–±è®€è©²æ–‡ç« ï¼
2. æ­¤æ–‡ç« æœƒæåŠä¸€äº›JSåè©ï¼Œæœƒç›¡é‡ç°¡å–®ä»‹ç´¹ï¼Œå¦‚æœæ‚¨æƒ³è¦æ›´æ·±å…¥åœ°å»ç­è§£é‚£äº›æ±è¥¿ï¼Œä»¥ä¸‹æä¾›ç›¸é—œé€£çµï¼Œæˆ‘ä¹Ÿæœƒåœ¨æ–‡ä¸­çš„è§£ææä¾›MSDNç­‰å…¶ä»–å¹³å°é€£çµè®“æ‚¨åƒè€ƒå­¸ç¿’ã€‚
* discord.js docs: https://discord.js.org/#/  
* MSDN JavaScript Docs: https://developer.mozilla.org/zh-TW/docs/Web/JavaScript  
:::
<!--truncate-->

## å‰è¨€
ç›¸ä¿¡æœ‰äº›äººåœ¨å‰›å…¥å‘discord.jsçš„æ™‚å€™ï¼Œæ‡‰è©²æœ‰è¢«discord.jsæ²’æœ‰å…§é™„æŒ‡ä»¤ç³»çµ±é€™ä»¶äº‹çµ¦åš‡åˆ°å§ï¼Ÿå°¤å…¶ä»¥å‰æœ‰ç¢°éNextCordç­‰æœ‰é™„æŒ‡ä»¤ç³»çµ±æ¨¡çµ„çš„ç©å®¶ï¼Œåˆ°äº†discord.jså¾Œï¼Œç™¼ç¾æ²’æœ‰æŒ‡ä»¤ç³»çµ±ï¼Œå¯èƒ½å°±æœƒè¢«æåˆ°ä¸æƒ³å…¥å‘äº†ï¼Œæˆ–è€…å°±ä¹¾è„†åªå»ºç«‹ä¸€å€‹messageCreateç›£è½å™¨ï¼Œç„¶å¾ŒæŒ‡ä»¤è™•ç†èˆ‡æŒ‡ä»¤ç¨‹å¼ç¢¼å…¨éƒ¨å¡åœ¨è£¡é¢......  

ä¸æƒ³å…¥å‘çš„è©±æˆ‘æ˜¯æ²’ä»€éº¼æ„è¦‹ï¼Œç•¢ç«Ÿæ¯å€‹äººéƒ½æœ‰è‡ªå·±çš„é¸æ“‡ã€‚ä½†æ˜¯åªå»ºç«‹ä¸€å€‹messageCreateç›£è½å™¨ï¼Œä¸¦ä¸”æŠŠæŒ‡ä»¤ç¨‹å¼ç¢¼å…¨éƒ¨å¡åœ¨è£¡é ­ï¼Œæˆ‘è¦ºå¾—çœŸçš„æœƒå¾ˆäº‚ï¼Œä¸¦ä¸”æŒ‡ä»¤ä¸€å¤šä»¥å¾Œï¼Œè¦æ”¹æŒ‡ä»¤æ™‚ï¼Œå°‹æ‰¾æŒ‡ä»¤å°±æœƒè®Šæˆä½ ç¶­è­·ä½ æ©Ÿå™¨äººæ™‚æ®ä¹‹ä¸å»çš„å™©å¤¢......  

æ‰€ä»¥æƒ³å¯«æ­¤ç¯‡æ–‡ç« ï¼Œè®“å¤§å®¶çŸ¥é“ä¸€å€‹ç°¡æ˜“æŒ‡ä»¤ç³»çµ±è¦æ€éº¼åšï¼Œè®“æ©Ÿå™¨äººçš„æ–‡å­—æŒ‡ä»¤è®Šå¾—å®¹æ˜“ç¶­è­·ã€‚ 

## å…ˆè¬›ä¸€ä¸‹æŒ‡ä»¤æ§‹é€ 
å—¯ï¼Œå…ˆä¾†è¬›ä¸€ä¸‹ä¸€å€‹æŒ‡ä»¤çš„æ§‹é€ å§ï¼ˆåœ¨æ­¤ä»¥banæŒ‡ä»¤èˆ‰ä¾‹ï¼‰ï¼æŒ‡ä»¤æ§‹é€ çš„åè©åœ¨ç­‰ä¸€ä¸‹å‡ºç¾å–”ï¼  
![](https://i.imgur.com/OG1sRhC.png)
1. **å‰ç¶´ï¼š**å¹¾ä¹æ¯å€‹botéƒ½æœ‰çš„ï¼Œæœ‰é»åƒä¸€å€‹è­˜åˆ¥ï¼Œé€šå¸¸èƒ½è®“äººçŸ¥é“è‡ªå·±è¼¸å…¥å“ªä¸€å€‹æ©Ÿå™¨äººçš„æŒ‡ä»¤  
2. **æŒ‡ä»¤åç¨±/åˆ¥åï¼š**ä½ å¸Œæœ›æ©Ÿå™¨äººåšä»€éº¼äº‹
3. **æŒ‡ä»¤åƒæ•¸ï¼š**åŸ·è¡ŒæŒ‡ä»¤æ‰€éœ€çš„ä¸€äº›è³‡è¨Šï¼Œæœ‰äº›æŒ‡ä»¤æœƒæœ‰ï¼Œä¹Ÿæœ‰äº›æœƒæ²’æœ‰

## æŒ‡ä»¤ç³»çµ±çš„æ§‹é€ 
ä¸€å€‹æœ€åŸºæœ¬æŒ‡ä»¤ç³»çµ±æœƒæœ‰ä»¥ä¸‹å¹¾å€‹æ§‹é€ ï¼š  
* **æŒ‡ä»¤è¼‰å…¥å™¨ï¼š**å»æŒ‡ä»¤ç¨‹å¼ç¢¼è³‡æ–™å¤¾è®€å–æŒ‡ä»¤çš„ç¨‹å¼ç¢¼æª”æ¡ˆï¼Œä¸¦å°‡æª”æ¡ˆæ›è¼‰ã€‚  
* **æŒ‡ä»¤æš«å­˜å€ï¼š**å°‡æ›è¼‰é€²ä¾†çš„æŒ‡ä»¤é€²è¡Œå„²å­˜ï¼Œä»¥åˆ©åœ¨å¾ŒçºŒåŸ·è¡ŒæŒ‡ä»¤æ™‚ï¼Œèƒ½ç›´æ¥å¾è©²å„²å­˜ç©ºé–“å°‹æ‰¾ä¸¦åŸ·è¡Œç›¸å°æ‡‰æŒ‡ä»¤çš„ç¨‹å¼ç¢¼ã€‚  
* **æŒ‡ä»¤è™•ç†å™¨ï¼š**æ¥æ”¶åˆ°è¨Šæ¯å¾Œï¼Œè² è²¬åˆ¤æ–·è¨Šæ¯æ˜¯å¦ç‚ºæŒ‡ä»¤ï¼Œç¬¦ä¸ç¬¦åˆæŒ‡ä»¤åŸ·è¡Œæ¢ä»¶ç­‰ï¼Œä¸¦å°è¨Šæ¯é€²è¡Œåˆ†æå¾Œï¼Œå»æŒ‡ä»¤å„²å­˜å€æ‰¾åˆ°å°æ‡‰æŒ‡ä»¤ä¸¦åŸ·è¡Œã€‚  

## æŒ‡ä»¤ç³»çµ±çš„åŸ·è¡Œæµç¨‹  
æ©Ÿå™¨äººä¸Šç·šå‰åˆå§‹åŒ–æ™‚ï¼š  
1. æŒ‡ä»¤è¼‰å…¥å™¨è¼‰å…¥æŒ‡ä»¤  

ä¸Šç·šå¾Œï¼Œæ¥æ”¶åˆ°å‰µå»ºè¨Šæ¯äº‹ä»¶ï¼ˆ``on("messageCreate",(message) => {})``ï¼‰ï¼š  
1. åˆ¤æ–·ã€åˆ†ææŒ‡ä»¤ï¼ˆåˆ†ææŒ‡ä»¤åç¨±ã€åƒæ•¸ç­‰ï¼‰  
2. å»æŒ‡ä»¤æš«å­˜å€å°‹æ‰¾æ˜¯å¦æœ‰ç›¸å°æ‡‰çš„æŒ‡ä»¤  
3. åŸ·è¡ŒæŒ‡ä»¤ï¼ˆå¦‚æœæŒ‡ä»¤æœ‰æ‰¾åˆ°ï¼‰  

## å»ºç«‹æŒ‡ä»¤ç¨‹å¼ç¢¼è³‡æ–™å¤¾èˆ‡æŒ‡ä»¤æš«å­˜å€
### å»ºç«‹æŒ‡ä»¤ç¨‹å¼ç¢¼æª”æ¡ˆå­˜æ”¾è™•

é¦–å…ˆï¼Œè«‹å…ˆåœ¨å°ˆæ¡ˆè³‡æ–™å¤¾ä¸‹æ–°å¢ä¸€å€‹è³‡æ–™å¤¾ï¼ˆå­˜æ”¾æŒ‡ä»¤ç¨‹å¼ç¢¼æª”æ¡ˆç”¨ï¼‰ï¼š  
![](https://i.imgur.com/7xezTI6.png)  

### å‰µå»ºæŒ‡ä»¤æš«å­˜å€
å†ä¾†ï¼Œæˆ‘å€‘ä¾†å‰µå»ºæŒ‡ä»¤æš«å­˜å€å§ï¼  
è«‹å°‡è¼‰å…¥discord.jsæ¨¡çµ„çš„é‚£ä¸€è¡Œï¼š  
<SyntaxHighlighter language="javascript" showLineNumbers={true} style={dracula}>
{`const { Client, Intents } = require("discord.js");`}
</SyntaxHighlighter>

çš„å¤§æ‹¬è™Ÿå…§æœ€å¾Œé¢ï¼Œå¤šåŠ ä¸Šä¸€å€‹``, Collection``ä»¥è¼‰å…¥Collectionï¼š  
<SyntaxHighlighter language="javascript" showLineNumbers={true} style={dracula}>
{`const { Client, Intents, Collection } = require("discord.js");`}
</SyntaxHighlighter>

ä¸¦è«‹åœ¨ ``client.on("ready",() => {})`` ä¸Šä¸€è¡ŒåŠ ä¸Šï¼š  
<SyntaxHighlighter language="javascript" showLineNumbers={true} style={dracula}>
{`client.commands = new Collections()`}
</SyntaxHighlighter>

:::info NOTE
ç•¶ç„¶åœ¨æ­¤æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨Mapï¼Œåªæ˜¯åŠŸèƒ½éƒ¨åˆ†ï¼ŒMapèˆ‡discord.jså®˜æ–¹æ’°å¯«çš„Collectionç›¸æ¯”ï¼ŒCollectionåŠŸèƒ½æœƒæ¯”è¼ƒå¤šï¼Œä½¿ç”¨èµ·ä¾†æœƒæ¯”è¼ƒæ–¹ä¾¿  

Mapç°¡å–®ä¾†èªªå°±æ˜¯ä¸€å€‹å„²å­˜å¾ˆå¤šéµå€¼å°(key-value)çš„ç‰©ä»¶ï¼Œè·Ÿå­—å…¸ç›¸ä¼¼ï¼Œå¦‚æœæƒ³æ·±å…¥äº†è§£å¯åƒè€ƒ[MSDNæ–‡ä»¶çš„Mapä»‹ç´¹]("https://developer.mozilla.org/zh-TW/docs/orphaned/Web/JavaScript/Reference/Global_Objects/Map")
<details>
<summary>Mapå’ŒCollectionçš„functionå°æ¯”è¼ƒï¼ˆæœƒåˆ—ä¸€äº›å€‹äººè¦ºå¾—æ¯”è¼ƒå¸¸ç”¨çš„ï¼‰</summary>

| function | Map | Collection |
| -------- | --- | ---------- |
| set      | æœ‰  | æœ‰         |
| get      | æœ‰  | æœ‰         |
| delete   | æœ‰  | æœ‰         |
| equals   | ç„¡   | æœ‰         |
| map      | ç„¡   | æœ‰         |
| find      | ç„¡   | æœ‰         |
| findKey      | ç„¡   | æœ‰         |
| filter      | ç„¡   | æœ‰         |
| first      | ç„¡   | æœ‰         |
</details>
:::

## æŒ‡ä»¤è¼‰å…¥å™¨
å†ä¾†æˆ‘å€‘å¯«æŒ‡ä»¤è¼‰å…¥å™¨å§ï¼ä¸ç„¶æ’°å¯«äº†å¤šå°‘æŒ‡ä»¤ï¼Œå¦‚æœæ²’æœ‰è¼‰å…¥ä¹Ÿæ˜¯æ²’è¾¦æ³•ä½¿ç”¨ã€‚  

è«‹å…ˆåœ¨``index.js``åŒå±¤è³‡æ–™å¤¾ä¸‹æ–°å¢``commandLoader.js``  
é¦–å…ˆï¼Œæˆ‘å€‘è¼‰å…¥è®€å–æª”æ¡ˆèˆ‡è³‡æ–™å¤¾çš„æ¨¡çµ„æ¨¡çµ„ï¼š  
<SyntaxHighlighter language="javascript" showLineNumbers={true} style={dracula}>
{`const { readdirSync } = require("fs");`}
</SyntaxHighlighter>

å†å»ºç«‹ä¸€å€‹functionç”¨ä¾†è¼‰å…¥æŒ‡ä»¤ï¼Œä¸¦ä¸”åŒ¯å‡ºï¼š  
<SyntaxHighlighter language="javascript" showLineNumbers={true} style={dracula}>
{`function loadCommands(client, directory) {
    
}
  
module.exports = loadCommands;`}
</SyntaxHighlighter>

:::info NOTE
æ‚¨ä¹Ÿå¯ä»¥é€™æ¨£å¯«ï¼ˆæˆ‘ä¹Ÿæ¯”è¼ƒç¿’æ…£é€™æ¨£å¯«ï¼Œä½†æ–°æ‰‹æ¨è–¦ä¸Šé¢é‚£ç¨®ï¼‰ï¼š  
<SyntaxHighlighter language="javascript" showLineNumbers={true} style={dracula}>
{`module.exports = function loadCommands(client, directory) {
    
};`}
</SyntaxHighlighter>
:::

æ¥ä¸‹ä¾†å°±é–‹å§‹å¯¦ä½œè¼‰å…¥æŒ‡ä»¤å§ï¼  
é¦–å…ˆå…ˆè®€å–æŒ‡ä»¤ç¨‹å¼ç¢¼æª”æ¡ˆè³‡æ–™å¤¾ï¼š  
<SyntaxHighlighter language="javascript" showLineNumbers={true} style={dracula}>
{`function loadCommands(client, directory) {
    const files = readdirSync(directory, {
        withFileTypes: true,
    });
};`}
</SyntaxHighlighter>
è®€å–å®Œå¾Œï¼Œæ¥è‘—é–‹å§‹å°è®€å–åˆ°çš„æª”æ¡ˆæˆ–è³‡æ–™å¤¾é€å€‹é€²è¡Œè™•ç†ï¼š  
<SyntaxHighlighter language="javascript" showLineNumbers={true} style={dracula}>
{`function loadCommands(client, directory) {
    //å»¶çºŒä¸Šæ–¹ç¨‹å¼ç¢¼
    for (const file of files) {
        if (file.isDirectory()) {                             //å¦‚æœè®€å–åˆ°è³‡æ–™å¤¾
            loadCommands(client, \`\${directory}/\${file.name}\`);//é€²å…¥è©²è³‡æ–™å¤¾ç¹¼çºŒè®€å–
        } else if (file.name.endsWith(".js")) {               //å¦‚æœæ˜¯JavaScriptæª”æ¡ˆ
            const cmd = require(\`\${directory}/\${file.name}\`); //æ›è¼‰æŒ‡ä»¤ç¨‹å¼ç¢¼æª”æ¡ˆ
            client.commands.set(cmd.name, cmd);               //å°‡æŒ‡ä»¤å­˜å…¥å‰é¢å»ºç«‹çš„æŒ‡ä»¤æš«å­˜å€
        }
    }
};`}
</SyntaxHighlighter>

æœ€å¾Œï¼Œå›åˆ°``index.js``ï¼Œåœ¨``client.login()``å‰ä¸€è¡ŒåŠ ä¸Šï¼š  
<SyntaxHighlighter language="javascript" showLineNumbers={true} style={dracula}>
{`require("./commandLoader.js")(client, "./Command") //è¼‰å…¥å‰›å‰›å¯«çš„loadCommands functionä¸¦åŸ·è¡Œ`}
</SyntaxHighlighter>

## æŒ‡ä»¤è™•ç†å™¨
åˆ°æ­¤ï¼Œçµ‚æ–¼å¯ä»¥æ’°å¯«æŒ‡ä»¤è™•ç†å™¨ï¼Œè®“æŒ‡ä»¤è™•ç†å™¨åœ¨æ¥æ”¶åˆ°è¨Šæ¯å¾Œï¼Œåšé€²ä¸€æ­¥çš„è™•ç†äº†ï¼  
### å…ˆåšå€‹å°å„ªåŒ–ï¼šåƒæ•¸åˆ‡å‰²èˆ‡åˆ¤æ–·å°ä¿®æ”¹
åœ¨[ä½¿ç”¨ discord.js å¿«é€Ÿå»ºç«‹ä¸€å€‹ Discord éª°å­æ©Ÿå™¨äºº](https://yeecord.com/blog/discordjs-dice-bot/)æ–‡ç« ä¸­ï¼Œç›¸ä¿¡æ‚¨å€‘å·²ç¶“å­¸åˆ°äº†å¦‚ä½•é€²è¡ŒæŒ‡ä»¤åˆæ­¥è™•ç†ï¼Œä½†é¿å…åœ¨å¾ŒçºŒåšæŒ‡ä»¤æ™‚æœƒæœ‰ä¸€äº›å•é¡Œï¼Œé‚„æœ‰æé«˜ç†è§£æ€§ï¼Œåœ¨é€™æˆ‘å»ºè­°åšä¸€äº›å°å„ªåŒ–ï¼š  
<SyntaxHighlighter language="javascript" showLineNumbers={true} style={dracula}>
{`client.on("messageCreate", (message) => {
    const prefix = "/"; // å¦‚æœè¦æ”¹æˆè‡ªå·±çš„å‰ç¶´ï¼Œæ”¹"è£¡é¢çš„å­—ä¸²
    if (!message.content.startsWith(prefix) || message.author.bot) return; //ä¿®æ”¹æ­¤è¡Œï¼Œç•¶ç™¼è¨Šæ¯è€…ç‚ºæ©Ÿå™¨äººæ™‚ä¹Ÿä¸åŸ·è¡ŒæŒ‡ä»¤
  
    const args = message.content.slice(prefix.length).trim().split(/ +/g);//ä¿®æ”¹æ­¤è¡Œï¼Œä¿®æ­£åƒæ•¸åˆ‡å‰²
    //...
});`}
</SyntaxHighlighter>

:::info ç¨‹å¼ç¢¼è§£æ
1. ``message.author.bot``ï¼šé¿å…æ©Ÿå™¨äººäº’callï¼Œæ‰€ä»¥åŠ ä¸Šé€™å€‹ï¼Œé¿å…æœ‰æ©Ÿå™¨äººåœ¨ç™¼æ­¤æ©Ÿå™¨äººçš„æŒ‡ä»¤è¨Šæ¯æ™‚ï¼Œè§¸ç™¼æ­¤æ©Ÿå™¨äºº
2. ``split(/ +/g)``ã€``trim()``ï¼šé¦–å…ˆï¼Œç‚ºäº†é¿å…æœ‰äººåœ¨è¼¸å…¥æŒ‡ä»¤æ™‚æ‰‹æ®˜ï¼Œåƒæ•¸èˆ‡åƒæ•¸é–“ç©ºæ ¼è¼¸å…¥æˆå…©å€‹ä»¥ä¸Šï¼Œé€ æˆæŒ‡ä»¤è™•ç†æ™‚åˆ‡å‡ºç©ºåƒæ•¸ï¼Œé€²è€Œé€ æˆå¾ŒçºŒåŸ·è¡Œå•é¡Œï¼Œæ‰€ä»¥æ‰æ”¹æˆ``split(/ +/g)``ï¼Œç°¡å–®ä¾†è¬›æ„æ€æ˜¯ä»¥ä¸€å€‹æˆ–å¤šå€‹é€£çºŒç©ºæ ¼é€²è¡Œåˆ‡å‰²ã€‚``/ +/g``æ˜¯æ­£å‰‡è¡¨é”å¼ï¼ˆRegular Expressionï¼Œæˆ–ç¨±æ­£è¦è¡¨é”å¼ã€æ­£è¦è¡¨ç¤ºå¼ï¼‰ï¼Œå¦‚æœæƒ³æ·±å…¥äº†è§£æ­£å‰‡è¡¨é”å¼ï¼Œè«‹åƒè€ƒ[MSDNæ­£å‰‡è¡¨é”å¼æ–‡ä»¶]("https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Guide/Regular_Expressions") ï¼›``trim()``å‰‡æ˜¯å»æ‰æ•´å€‹å­—ä¸²çš„é ­å°¾ç©ºæ ¼ã€‚
:::

### æ­£å¼é–‹å§‹å¯¦ä½œå§ï¼
#### 1.è™•ç†åƒæ•¸
å…ˆé€²è¡ŒæŒ‡ä»¤åç¨±èˆ‡åƒæ•¸åˆ†é›¢å‹•ä½œã€‚è«‹å°‡å‰›å‰›åˆ‡å‰²åƒæ•¸é‚£è¡Œé€²è¡Œä¿®æ”¹ï¼š  
<SyntaxHighlighter language="javascript" showLineNumbers={true} style={dracula}>
{`const [command, ...args] = message.content.slice(prefix.length).trim().split(/ +/g);`}
</SyntaxHighlighter>

:::info ç¨‹å¼ç¢¼è§£æ
``split(/ +/g)``æœƒå‚³å›ä¸€å€‹é™£åˆ—ï¼Œä¸¦å°‡é™£åˆ—ç¬¬ä¸€é …æŒ‡æ´¾çµ¦commandï¼Œå‰©ä¸‹çš„å…ƒç´ æœƒåœ¨è¢«å…¨éƒ¨æ”¶é›†å¾Œï¼ŒæŒ‡æ´¾çµ¦argsé™£åˆ—ã€‚``...``ç‚ºåŒ¯é›†/å±•é–‹é‹ç®—å­ (Spread Operator)ï¼Œåœ¨é€™è£¡æ˜¯åŒ¯é›†ç”¨ï¼Œä¹Ÿå°±æ˜¯æŠŠå‰©ä¸‹çš„é™£åˆ—å…ƒç´ åŒ¯é›†æˆé™£åˆ—ã€‚è‹¥æƒ³æ·±å…¥äº†è§£è«‹åƒè€ƒ[æ­¤æ–‡ç« ]("https://pjchender.blogspot.com/2017/01/es6-spread-operatorrest-operator.html")
:::

#### 2.æŒ‡ä»¤æš«å­˜å€å°‹æ‰¾æŒ‡ä»¤ä¸¦åŸ·è¡Œ
è«‹å…ˆå°‡æŒ‡ä»¤ï¼ˆä¾‹å¦‚å…ˆå‰å»ºç«‹çš„DiceæŒ‡ä»¤ï¼‰ç¨‹å¼ç¢¼å…ˆçµ¦è¤‡è£½å¾Œï¼Œè²¼åˆ°å…¶ä»–æª”æ¡ˆå‚™ç”¨ï¼š
![](https://i.imgur.com/P2mWy6o.png)

å†ä¾†ï¼Œè«‹å…ˆåˆªé™¤æ•´å€‹switchåˆ¤æ–·å¼ï¼Œåˆªé™¤å®Œå¾Œæœƒé•·é€™æ¨£ï¼š  
<SyntaxHighlighter language="javascript" showLineNumbers={true} style={dracula}>
{`client.on("messageCreate", (message) => {
    const prefix = "/"; 
    if (!message.content.startsWith(prefix) || message.author.bot) return;  
      
    const [command,...args] = message.content.slice(prefix.length).split(/ +/g);  
});`}
</SyntaxHighlighter>
ç„¶å¾Œå†æ’°å¯«å°‹æ‰¾æŒ‡ä»¤ä¸¦åŸ·è¡Œçš„ç¨‹å¼ç¢¼ï¼š  
<SyntaxHighlighter language="javascript" showLineNumbers={true} style={dracula}>
{`client.on("messageCreate", (message) => {
    //å»¶çºŒä¸Šæ–¹ç¨‹å¼ç¢¼
    const cmdObject = client.commands.get(command)    //å°‹æ‰¾æœ‰æ²’æœ‰é€™å€‹æŒ‡ä»¤
    cmdObject?.run(message, args, client)             //å¦‚æœæœ‰çš„è©±å°±åŸ·è¡ŒæŒ‡ä»¤ç¨‹å¼ç¢¼
});`}
</SyntaxHighlighter>

:::info ç¨‹å¼ç¢¼è§£æ
``cmdObject?.run()``çš„``?``æ˜¯éå¼·åˆ¶ä¸²æ¥é‹ç®—å­ï¼ˆOptional Chainingï¼Œæˆ–ç¨±å¯é¸ä¸²è¯é‹ç®—å­ï¼‰ï¼Œåœ¨é€™è£¡çš„ä½œç”¨æ˜¯ï¼šç•¶åŸ·è¡Œrun functionå‰ï¼Œæœƒå…ˆç¢ºèªæŒ‡ä»¤ç‰©ä»¶æœ‰æ²’æœ‰è¢«æ‰¾åˆ°ï¼Œå¦‚æœæœ‰æ‰¾åˆ°å°±æœƒåŸ·è¡Œrun functionï¼Œå¦å‰‡ä¸åŸ·è¡Œã€‚ä¹Ÿå°±æ˜¯èªªï¼Œæ­¤è¡Œç¨‹å¼ç¢¼èˆ‡ä¸‹æ–¹é€™æ®µä½œç”¨ç›¸åŒï¼š  
<SyntaxHighlighter language="javascript" showLineNumbers={true} style={dracula}>
{`if(cmdObject){                            //ç¢ºèªæŒ‡ä»¤ç‰©ä»¶æœ‰æ²’æœ‰æ‰¾åˆ°
    cmdObject.run(message, args, client)  //æœ‰çš„è©±å°±åŸ·è¡Œ
}`}
</SyntaxHighlighter>

è‹¥æƒ³æ·±å…¥äº†è§£éå¼·åˆ¶ä¸²æ¥é‹ç®—å­ï¼Œè«‹åƒè€ƒ[MSDNéå¼·åˆ¶ä¸²æ¥é‹ç®—å­æ–‡ä»¶](https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Operators/Optional_chaining)
:::

## æ’°å¯«æŒ‡ä»¤æª”æ¡ˆ
æ­å–œæ‚¨ï¼æ‚¨å·²ç¶“æˆåŠŸå®ŒæˆæŒ‡ä»¤ç³»çµ±ï¼Œä¸¦ä¸”å¯ä»¥é–‹å§‹æ’°å¯«æŒ‡ä»¤äº†ï¼

è«‹å…ˆåœ¨``Command``è³‡æ–™å¤¾ä¸‹ï¼Œå»ºç«‹ä¸€å€‹JavaScriptæª”æ¡ˆï¼ˆåœ¨æ­¤ä»¥DiceæŒ‡ä»¤ç•¶ç¯„ä¾‹ï¼Œæ•…å–å``Dice.js``ï¼‰ï¼š  
![](https://i.imgur.com/YFqPSYP.png)

å†ä¾†ï¼Œå»ºç«‹æŒ‡ä»¤ï¼š
:::warning
**æœ‰ç”¨åˆ°Node.jsæ²’å…§å»ºçš„æ±è¥¿è«‹è¨˜å¾—åŒ¯å…¥ï¼ï¼ˆä¾‹å¦‚ï¼š``MessageEmbed``ï¼‰**
:::
<SyntaxHighlighter language="javascript" showLineNumbers={true} style={dracula}>
{`const { MessageEmbed } = require("discord.js")
  
module.exports = {
    name: "dice",
    run: async (message, args, bot) => {
        const final = Math.floor(Math.random() * (6 - 1)) + 1;
        const diceEmbed = new MessageEmbed()
            .setTitle(\`ğŸ² ä½ å¾—åˆ°äº† \${final}\`)
            .setColor("#5865F2");
        return message.reply({
            embeds: [diceEmbed],
        });
    },
};`}
</SyntaxHighlighter>

æœ€å¾Œï¼Œå•Ÿå‹•æ©Ÿå™¨äººä¸¦è¼¸å…¥æŒ‡ä»¤ï¼  
![](https://i.imgur.com/qsLHoTz.png)

## ç¸½çµ
è‡³æ­¤ï¼Œæ­å–œæ‚¨å®Œæˆäº†ä¸€å€‹ç°¡æ˜“çš„æŒ‡ä»¤ç³»çµ±ï¼è‹¥æ‚¨æœ‰å•é¡Œï¼Œå¯ä»¥å‰å¾€Yeecordæ”¯æ´ç¾¤çµ„å°‹æ±‚å”åŠ©ï¼  
é †å¸¶ä¸€æï¼Œä¸‹é¢æœ‰ä¸€äº›å»¶ä¼¸ï¼Œå¦‚æœæ‚¨è¦ºå¾—æ‚¨åœ¨é–‹ç™¼ä¸Šæœ‰éœ€è¦ï¼Œå¯ä»¥ç¹¼çºŒé–±è®€ï¼  

## å»¶ä¼¸ä¸€ï¼šæ€éº¼å«ï¼Œéƒ½æ˜¯å«æˆ‘ï¼ï¼æŒ‡ä»¤åˆ¥å
å’¦ï¼Ÿæ€éº¼æœ‰äººçœ‹ä¼¼è¼¸å…¥ä¸åŒçš„æŒ‡ä»¤åç¨±ï¼Œä½†å¯¦éš›ä¸Šå»å‘¼å«åˆ°åŒä¸€å€‹æŒ‡ä»¤ï¼Ÿ  
é€™å°±æ˜¯æŒ‡ä»¤åˆ¥åï¼Œä¹Ÿå°±æ˜¯ä¸€å€‹æŒ‡ä»¤å¯ä»¥ç”¨å¤šç¨®æŒ‡ä»¤åç¨±ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥ä»¥å¤šå€‹æŒ‡ä»¤åç¨±å‘¼å«æ­¤æŒ‡ä»¤ï¼  

å¦‚æœè¦å¯¦ä½œï¼Œé¦–å…ˆæˆ‘å€‘å¾—ä¿®æ”¹ä¸€ä¸‹``index.js``ã€‚è«‹åœ¨``client.commands``é‚£è¡Œçš„ä¸Šä¸€è¡Œæˆ–ä¸‹ä¸€è¡ŒåŠ ä¸Šï¼š
<SyntaxHighlighter language="javascript" showLineNumbers={true} style={dracula}>
{`client.aliases = new Collection() //åˆ¥åèˆ‡æŒ‡ä»¤åç¨±å°æ‡‰æš«å­˜å€`}
</SyntaxHighlighter>

å†ä¾†ï¼Œè«‹é–‹å•Ÿ``commandLoader.js``ä¸¦åšä»¥ä¸‹ä¿®æ”¹ï¼š
<SyntaxHighlighter language="javascript" showLineNumbers={true} style={dracula}>
{`module.exports = function loadCommands(client, directory) {
    //ä»¥ä¸Šç•¥
    for (const file of files) {
        if (file.isDirectory()) {
            loadCommands(client, \`\${directory}/\${file.name}\`);
        } else if (file.name.endsWith(".js")) {
            const cmd = require(\`\${directory}/\${file.name}\`);
            client.commands.set(cmd.name, cmd);
            
            //-----ä¿®æ”¹å¾é€™è£¡é–‹å§‹-----
            if(cmd.aliases){                            //å¦‚æœæŒ‡ä»¤æœ‰å„²å­˜åˆ¥åçš„é™£åˆ—
                for(const aliase of cmd.aliases){       //å‰‡å°‡åˆ¥åé™£åˆ—è£¡é¢çš„æ¯ä¸€å€‹åˆ¥åå­—ä¸²é€å€‹è™•ç†
                    client.aliases.set(aliase,cmd.name) //å°‡åˆ¥åèˆ‡æŒ‡ä»¤åŸå§‹åç¨±å°æ‡‰å¯«å…¥
                }
            }
            //------------------
        }
    }
};`}
</SyntaxHighlighter>

æœ€å¾Œå†å›åˆ°``index.js``ä¸¦ä¿®æ”¹``const cmdObject``é‚£ä¸€è¡Œï¼š
<SyntaxHighlighter language="javascript" showLineNumbers={true} style={dracula}>
{`const cmdObject = client.commands.get(command) ?? client.commands.get(client.aliases.get(command))`}
</SyntaxHighlighter>

:::info ç¨‹å¼ç¢¼è§£æ
æ­¤æ­¥æ„æ€æ˜¯å…ˆå»æŒ‡ä»¤æš«å­˜å€æ‰¾æœ‰æ²’æœ‰å°æ‡‰æŒ‡ä»¤ï¼Œå¦‚æœæ²’æœ‰ï¼Œå†å»åˆ¥åèˆ‡æŒ‡ä»¤åç¨±å°æ‡‰å„²å­˜å€å°‹æ‰¾æ­¤åˆ¥åæœ‰æ²’æœ‰è¢«å®šç¾©ï¼Œå¦‚æœæœ‰è¢«å®šç¾©å‰‡æœƒå‰å¾€æŒ‡ä»¤æš«å­˜å€å°‹æ‰¾è©²åˆ¥åå°æ‡‰åˆ°çš„æŒ‡ä»¤ã€‚åä¹‹è‹¥æ²’æ‰¾åˆ°ï¼Œä¹Ÿæœƒå›å»æŒ‡ä»¤æš«å­˜å€æœå°‹æ²’éŒ¯ï¼Œä½†é€šå¸¸æœƒæ‰¾ä¸åˆ°ï¼ˆé™¤éçœŸçš„æœ‰ä¸€å€‹æŒ‡ä»¤åç¨±å«undefinedï¼‰ã€‚  
``??``ç‚ºç©ºå€¼åˆä½µé‹ç®—å­ï¼ˆNullish Coalescing Operatorï¼‰ï¼Œç•¶æ­¤é‹ç®—å­å‰é¢çš„å€¼ç‚ºnullæˆ–undefinedæ™‚ï¼Œæœƒå›å‚³æ­¤é‹ç®—å­å¾Œæ–¹çš„å€¼ã€‚å¦‚æœæƒ³æ·±å…¥äº†è§£å¯åƒè€ƒMSDNï¼šhttps://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing_operator
:::

æœ€å¾Œå°±å¯ä»¥ç‚ºæŒ‡ä»¤æ–°å¢åˆ¥åäº†ï¼ˆæ­¤ä»¥DiceæŒ‡ä»¤ç‚ºä¾‹ï¼‰ï¼š
<SyntaxHighlighter language="javascript" showLineNumbers={true} style={dracula}>
{`module.exports = {
    name: "dice",
    aliases: ["doce", "dace"],            //<---åƒé€™æ¨£æ–°å¢æŒ‡ä»¤åˆ¥åï¼ˆç•¶ç„¶é€™è£¡åˆ¥åæ˜¯äº‚å–çš„ï¼‰
    run: async (message, args, bot) => {
        const final = Math.floor(Math.random() * (6 - 1)) + 1;
        const diceEmbed = new MessageEmbed()
            .setTitle(\`ğŸ² ä½ å¾—åˆ°äº† \${final}\`)
            .setColor("#5865F2");
        return message.reply({
            embeds: [diceEmbed],
        });
    },
};`}
</SyntaxHighlighter>

å•Ÿå‹•å¾Œè¼¸å…¥æŒ‡ä»¤ï¼  
![](https://i.imgur.com/pikoWRT.png)

