---
title: å¦‚ä½•ç”¨ discord.js å»ºç«‹ä¸€å€‹æŒ‡ä»¤æ¡†æ¶ç³»çµ±
authors: [kay]
description: "æ•™å¤§å®¶ç°¡å–®å»ºç«‹èµ·ä¸€å€‹ discord.js æŒ‡ä»¤æ¡†æ¶ç³»çµ±ï¼Œè®“ç®¡ç†æŒ‡ä»¤æ›´ç³»çµ±æ€§ä»¥åŠæ–¹ä¾¿"
tags:
  [
    "Discord",
    "dc",
    "æ©Ÿå™¨äºº",
    "æŒ‡ä»¤",
    "æŒ‡ä»¤ç³»çµ±",
    "å»ºç«‹æ©Ÿå™¨äºº",
    "command",
    "commandHanlder",
    "discordjs",
    "discord.js",
  ]
date: 2022-07-01T11:38:17
image: /blog/discordjs-command-handler-1/discordjs-command-handler-1.jpeg
---

![discord.js æŒ‡ä»¤ æ¡†æ¶ç³»çµ±](/blog/discordjs-command-handler-1/discordjs-command-handler-1.jpeg)

é€™ç¯‡æ–‡ç« æœƒå¾ Wolf Yuan å…ˆçš„ [ã€Šä½¿ç”¨ discord.js å¿«é€Ÿå»ºç«‹ä¸€å€‹ Discord éª°å­æ©Ÿå™¨äººã€‹](/blog/discordjs-dice-bot/) æ–‡ç« ç¨‹å¼ç¢¼å»¶ä¼¸ï¼Œæ•™å¤§å®¶ç°¡å–®å»ºç«‹ä¸€å€‹æŒ‡ä»¤ç³»çµ±ï¼Œè®“ç®¡ç†æŒ‡ä»¤æ›´ç³»çµ±æ€§ä»¥åŠæ–¹ä¾¿ã€‚å¦‚æœæ‚¨æ˜¯ä¸€å€‹ discord.js æ–°æ‰‹ï¼Œä¸¦ä¸”å°æ­¤æ–‡ç« è¦ä¿®æ”¹ï¼ˆä¸å«æ’°å¯«ï¼‰çš„ç¨‹å¼ç¢¼æ„Ÿåˆ°é™Œç”Ÿè€…ï¼Œè«‹å…ˆé–±è®€è©²æ–‡ç« ï¼

<Info title='æˆ‘æƒ³å…ˆå‘ŠçŸ¥ä½ '>

æ­¤æ–‡ç« æœƒæåŠä¸€äº› JS åè©ï¼Œæœƒç›¡é‡ç°¡å–®ä»‹ç´¹ï¼Œå¦‚æœæ‚¨æƒ³è¦æ›´æ·±å…¥åœ°å»ç­è§£é‚£äº›æ±è¥¿ï¼Œä»¥ä¸‹æä¾›ç›¸é—œé€£çµï¼Œæˆ‘ä¹Ÿæœƒåœ¨æ–‡ä¸­çš„è§£ææä¾› MSDN ç­‰å…¶ä»–å¹³å°é€£çµè®“æ‚¨åƒè€ƒå­¸ç¿’ã€‚

- [discord.js](https://discord.js.org/)
- [MSDN JavaScript Docs](https://developer.mozilla.org/zh-TW/docs/Web/JavaScript)
- [Fooish JavaScript æ•™å­¸](https://www.fooish.com/javascript/)

</Info>

## å‰è¨€

ç›¸ä¿¡æœ‰äº›äººåœ¨å‰›å…¥å‘ discord.js çš„æ™‚å€™ï¼Œæ‡‰è©²æœ‰è¢« discord.js æ²’æœ‰å…§é™„æŒ‡ä»¤ç³»çµ±é€™ä»¶äº‹çµ¦åš‡åˆ°å§ï¼Ÿå°¤å…¶ä»¥å‰æœ‰ç¢°é [NextCord](https://github.com/nextcord/nextcord) ç­‰æœ‰é™„æŒ‡ä»¤ç³»çµ±æ¨¡çµ„çš„ç©å®¶ï¼Œåˆ°äº† discord.js å¾Œï¼Œç™¼ç¾æ²’æœ‰æŒ‡ä»¤ç³»çµ±ï¼Œå¯èƒ½å°±æœƒè¢«æåˆ°ä¸æƒ³å…¥å‘äº†ï¼Œæˆ–è€…å°±ä¹¾è„†åªå»ºç«‹ä¸€å€‹ `messageCreate` ç›£è½å™¨ï¼Œç„¶å¾ŒæŒ‡ä»¤è™•ç†èˆ‡æŒ‡ä»¤ç¨‹å¼ç¢¼å…¨éƒ¨å¡åœ¨è£¡é¢......

ä¸æƒ³å…¥å‘çš„è©±æˆ‘æ˜¯æ²’ä»€éº¼æ„è¦‹ï¼Œç•¢ç«Ÿæ¯å€‹äººéƒ½æœ‰è‡ªå·±çš„é¸æ“‡ã€‚ä½†æ˜¯åªå»ºç«‹ä¸€å€‹ `messageCreate` ç›£è½å™¨ï¼Œä¸¦ä¸”æŠŠæŒ‡ä»¤ç¨‹å¼ç¢¼å…¨éƒ¨å¡åœ¨è£¡é ­ï¼Œæˆ‘è¦ºå¾—çœŸçš„æœƒå¾ˆäº‚ï¼Œä¸¦ä¸”æŒ‡ä»¤ä¸€å¤šä»¥å¾Œï¼Œè¦æ”¹æŒ‡ä»¤æ™‚ï¼Œå°‹æ‰¾æŒ‡ä»¤å°±æœƒè®Šæˆä½ ç¶­è­·ä½ æ©Ÿå™¨äººæ™‚æ®ä¹‹ä¸å»çš„å™©å¤¢......

æ‰€ä»¥æƒ³å¯«æ­¤ç¯‡æ–‡ç« ï¼Œè®“å¤§å®¶çŸ¥é“ä¸€å€‹ç°¡æ˜“æŒ‡ä»¤ç³»çµ±è¦æ€éº¼åšï¼Œè®“æ©Ÿå™¨äººçš„æ–‡å­—æŒ‡ä»¤è®Šå¾—å®¹æ˜“ç¶­è­·ã€‚

æœ€å¾Œæœ‰ä»€éº¼æ–‡ç« å¯«ä¸å¥½çš„åœ°æ–¹ï¼Œæ­¡è¿æå‡ºå»ºè­°ï¼

## å…ˆè¬›ä¸€ä¸‹æŒ‡ä»¤æ§‹é€ 

å—¯ï¼Œå…ˆä¾†è¬›ä¸€ä¸‹ä¸€å€‹æŒ‡ä»¤çš„æ§‹é€ å§ï¼ˆåœ¨æ­¤ä»¥ ban æŒ‡ä»¤èˆ‰ä¾‹ï¼‰ï¼æŒ‡ä»¤æ§‹é€ çš„åè©åœ¨ç­‰ä¸€ä¸‹å‡ºç¾å–”ï¼

<Adsense />

![Discord è¨Šæ¯æŒ‡ä»¤ æ§‹é€ ](/blog/discordjs-command-handler-1/command-structure.png)

1. å‰ç¶´ï¼šå¹¾ä¹æ¯å€‹ bot éƒ½æœ‰çš„ï¼Œæœ‰é»åƒä¸€å€‹è­˜åˆ¥ï¼Œé€šå¸¸èƒ½è®“äººçŸ¥é“è‡ªå·±è¼¸å…¥å“ªä¸€å€‹æ©Ÿå™¨äººçš„æŒ‡ä»¤
2. æŒ‡ä»¤åç¨± / åˆ¥åï¼šä½ å¸Œæœ›æ©Ÿå™¨äººåšä»€éº¼äº‹
3. æŒ‡ä»¤åƒæ•¸ï¼šåŸ·è¡ŒæŒ‡ä»¤æ‰€éœ€çš„ä¸€äº›è³‡è¨Šï¼Œæœ‰äº›æŒ‡ä»¤æœƒæœ‰ï¼Œä¹Ÿæœ‰äº›æœƒæ²’æœ‰

### æŒ‡ä»¤è™•ç†åˆ†å±¤

ä¸€å€‹æœ€åŸºæœ¬æŒ‡ä»¤ç³»çµ±æœƒæœ‰ä»¥ä¸‹å¹¾å€‹æ§‹é€ ï¼š

1. æŒ‡ä»¤è¼‰å…¥å™¨ï¼šå»æŒ‡ä»¤ç¨‹å¼ç¢¼è³‡æ–™å¤¾è®€å–æŒ‡ä»¤çš„ç¨‹å¼ç¢¼æª”æ¡ˆï¼Œä¸¦å°‡æª”æ¡ˆæ›è¼‰ã€‚
2. æŒ‡ä»¤æš«å­˜å€ï¼šå°‡æ›è¼‰é€²ä¾†çš„æŒ‡ä»¤é€²è¡Œå„²å­˜ï¼Œä»¥åˆ©åœ¨å¾ŒçºŒåŸ·è¡ŒæŒ‡ä»¤æ™‚ï¼Œèƒ½ç›´æ¥å¾è©²å„²å­˜ç©ºé–“å°‹æ‰¾ä¸¦åŸ·è¡Œç›¸å°æ‡‰æŒ‡ä»¤çš„ç¨‹å¼ç¢¼ã€‚
3. æŒ‡ä»¤è™•ç†å™¨ï¼šæ¥æ”¶åˆ°è¨Šæ¯å¾Œï¼Œè² è²¬åˆ¤æ–·è¨Šæ¯æ˜¯å¦ç‚ºæŒ‡ä»¤ï¼Œç¬¦ä¸ç¬¦åˆæŒ‡ä»¤åŸ·è¡Œæ¢ä»¶ç­‰ï¼Œä¸¦å°è¨Šæ¯é€²è¡Œåˆ†æå¾Œï¼Œå»æŒ‡ä»¤å„²å­˜å€æ‰¾åˆ°å°æ‡‰æŒ‡ä»¤ä¸¦åŸ·è¡Œã€‚

### æŒ‡ä»¤ç³»çµ±çš„åŸ·è¡Œæµç¨‹

æ©Ÿå™¨äººä¸Šç·šå‰åˆå§‹åŒ–æ™‚ï¼Œæœƒå…ˆå°‡æŒ‡ä»¤è¼‰å…¥åˆ°ç¨‹å¼å…§ï¼Œç•¶æˆ‘å€‘åœ¨åŸ·è¡Œæ™‚ï¼Œæœƒåˆ†æˆä»¥ä¸‹ 4 å€‹æ­¥é©Ÿï¼š

1. æŒ‡ä»¤è¼‰å…¥å™¨è¼‰å…¥æŒ‡ä»¤
   ä¸Šç·šå¾Œï¼Œæ¥æ”¶åˆ°å‰µå»ºè¨Šæ¯äº‹ä»¶
   ```js
   on("messageCreate", (message) => {
     // åœ¨é€™è£¡ç¹¼çºŒåŸ·è¡Œ
   });
   ```
2. åˆ¤æ–·ã€åˆ†ææŒ‡ä»¤ï¼ˆåˆ†ææŒ‡ä»¤åç¨±ã€åƒæ•¸ç­‰ï¼‰
3. å»æŒ‡ä»¤æš«å­˜å€å°‹æ‰¾æ˜¯å¦æœ‰ç›¸å°æ‡‰çš„æŒ‡ä»¤
4. åŸ·è¡ŒæŒ‡ä»¤ï¼ˆå¦‚æœæŒ‡ä»¤æœ‰æ‰¾åˆ°ï¼‰

## å»ºç«‹æŒ‡ä»¤ç¨‹å¼ç¢¼è³‡æ–™å¤¾èˆ‡æŒ‡ä»¤æš«å­˜å€

é¦–å…ˆï¼Œè«‹å…ˆåœ¨å°ˆæ¡ˆè³‡æ–™å¤¾ä¸‹æ–°å¢ä¸€å€‹è³‡æ–™å¤¾ï¼ˆå­˜æ”¾æŒ‡ä»¤ç¨‹å¼ç¢¼æª”æ¡ˆç”¨ï¼‰ï¼š

<Adsense />

![Vscode å‰µå»ºè³‡æ–™å¤¾](/blog/discordjs-command-handler-1/create-folder.png)

### å‰µå»ºæŒ‡ä»¤æš«å­˜å€

å†ä¾†ï¼Œæˆ‘å€‘ä¾†å‰µå»ºæŒ‡ä»¤æš«å­˜å€å§ï¼  
è«‹å°‡è¼‰å…¥ discord.js æ¨¡çµ„çš„çš„å¤§æ‹¬è™Ÿå…§æœ€å¾Œé¢ï¼Œå¤šåŠ ä¸Šä¸€å€‹ `, Collection` ä»¥è¼‰å…¥ Collectionï¼š

```js
const { Client, Intents, Collection } = require("discord.js");
```

ä¸¦è«‹åœ¨æˆ‘å€‘ Ready äº‹ä»¶å…§åŠ ä¸Šä¸€è¡ŒåŠ ä¸Šåˆå§‹åŒ–æˆ‘å€‘çš„æŒ‡ä»¤ Collectionï¼š

```js showLineNumbers
client.on("ready", () => {
  client.commands = new Collection();
});
```

<Info title='æˆ‘æƒ³è¦ä½ åšå€‹ç­†è¨˜'>

ç•¶ç„¶åœ¨æ­¤æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ Mapï¼Œåªæ˜¯åŠŸèƒ½éƒ¨åˆ†ï¼ŒMap èˆ‡ discord.js å®˜æ–¹æ’°å¯«çš„ Collection ç›¸æ¯”ï¼ŒCollection åŠŸèƒ½æœƒæ¯”è¼ƒå¤šï¼Œä½¿ç”¨èµ·ä¾†æœƒæ¯”è¼ƒæ–¹ä¾¿ã€‚

Map ç°¡å–®ä¾†èªªå°±æ˜¯ä¸€å€‹å„²å­˜å¾ˆå¤šéµå€¼å° (key-value) çš„ç‰©ä»¶ï¼Œè·Ÿå­—å…¸ç›¸ä¼¼ï¼Œå¦‚æœæƒ³æ·±å…¥äº†è§£å¯åƒè€ƒ [MSDN æ–‡ä»¶çš„ Map ä»‹ç´¹](https://developer.mozilla.org/zh-TW/docs/orphaned/Web/JavaScript/Reference/Global_Objects/Map)

<details>
<summary>Map å’Œ Collection æ‰€æä¾›çš„å‡½æ•¸å°æ¯”è¼ƒï¼ˆæœƒåˆ—ä¸€äº›å€‹äººè¦ºå¾—æ¯”è¼ƒå¸¸ç”¨çš„ï¼‰</summary>

| å‡½æ•¸      | Map | Collection |
| --------- | --- | ---------- |
| set()     | æœ‰  | æœ‰         |
| get()     | æœ‰  | æœ‰         |
| delete()  | æœ‰  | æœ‰         |
| equals()  | ç„¡  | æœ‰         |
| map()     | ç„¡  | æœ‰         |
| find()    | ç„¡  | æœ‰         |
| findKey() | ç„¡  | æœ‰         |
| filter()  | ç„¡  | æœ‰         |
| first()   | ç„¡  | æœ‰         |

</details>

</Info>

## æŒ‡ä»¤è¼‰å…¥å™¨

å†ä¾†æˆ‘å€‘å¯«æŒ‡ä»¤è¼‰å…¥å™¨å§ï¼ä¸ç„¶æ’°å¯«äº†å¤šå°‘æŒ‡ä»¤ï¼Œå¦‚æœæ²’æœ‰è¼‰å…¥ä¹Ÿæ˜¯æ²’è¾¦æ³•ä½¿ç”¨ã€‚

è«‹å…ˆåœ¨ `index.js` åŒå±¤è³‡æ–™å¤¾ä¸‹æ–°å¢ `commandLoader.js`ï¼Œåœ¨è£¡é¢å¯«å…¥æˆ‘å€‘è¼‰å…¥è®€å–æª”æ¡ˆèˆ‡è³‡æ–™å¤¾çš„æ¨¡çµ„æ¨¡çµ„ï¼š

```js showLineNumbers
const { readdirSync } = require("fs");
```

å»ºç«‹ä¸€å€‹å‡½æ•¸ `loadCommands` ç”¨ä¾†è¼‰å…¥æŒ‡ä»¤ï¼Œä¸¦ä¸”åŒ¯å‡ºé€™å€‹å‡½æ•¸ï¼Œè®“å…¶ä»–æª”æ¡ˆä¹Ÿå¯ä»¥ä½¿ç”¨åˆ°ï¼š

```js showLineNumbers
function loadCommands(client, directory) {}

module.exports = loadCommands;
```

<Info title='ç­†è¨˜ä¸€ä¸‹'>

æ‚¨ä¹Ÿå¯ä»¥é€™æ¨£å¯«ï¼ˆæˆ‘ä¹Ÿæ¯”è¼ƒç¿’æ…£é€™æ¨£å¯«ï¼Œä½†æ–°æ‰‹æ¨è–¦ä¸Šé¢é‚£ç¨®ï¼‰ï¼š

```js showLineNumbers
module.exports = function loadCommands(client, directory) {};
```

</Info>

<Adsense />

æ¥ä¸‹ä¾†å°±é–‹å§‹å¯¦ä½œè¼‰å…¥æŒ‡ä»¤çš„éƒ¨åˆ†ï¼Œé¦–å…ˆå…ˆè®€å–æŒ‡ä»¤ç¨‹å¼ç¢¼æª”æ¡ˆè³‡æ–™å¤¾ï¼š

```js showLineNumbers
function loadCommands(client, directory) {
  const files = readdirSync(directory, {
    withFileTypes: true,
  });
}
```

è®€å–å®Œå¾Œï¼Œæ¥è‘—é–‹å§‹å°è®€å–åˆ°çš„æª”æ¡ˆæˆ–è³‡æ–™å¤¾é€å€‹é€²è¡Œè™•ç†ï¼š

```js showLineNumbers
function loadCommands(client, directory) {
  // å»¶çºŒä¸Šæ–¹ç¨‹å¼ç¢¼
  for (const file of files) {
    if (file.isDirectory()) {
      // å¦‚æœè®€å–åˆ°è³‡æ–™å¤¾
      loadCommands(client, `${directory}/${file.name}`); // é€²å…¥è©²è³‡æ–™å¤¾ç¹¼çºŒè®€å–
    } else if (file.name.endsWith(".js")) {
      // å¦‚æœæ˜¯JavaScriptæª”æ¡ˆ
      const cmd = require(`${directory}/${file.name}`); // æ›è¼‰æŒ‡ä»¤ç¨‹å¼ç¢¼æª”æ¡ˆ
      client.commands.set(cmd.name, cmd); // å°‡æŒ‡ä»¤å­˜å…¥å‰é¢å»ºç«‹çš„æŒ‡ä»¤æš«å­˜å€
    }
  }
}
```

æœ€å¾Œï¼Œå›åˆ° `index.js`ï¼Œåœ¨ `client.login()` å‰ä¸€è¡ŒåŠ ä¸Šï¼š

```js
require("./commandLoader.js")(client, "./Command"); // è¼‰å…¥å‰›å‰›å¯«çš„ loadCommands ä¸¦åŸ·è¡Œ
```

## æŒ‡ä»¤è™•ç†å™¨

åˆ°æ­¤ï¼Œçµ‚æ–¼å¯ä»¥æ’°å¯«æŒ‡ä»¤è™•ç†å™¨ï¼Œè®“æŒ‡ä»¤è™•ç†å™¨åœ¨æ¥æ”¶åˆ°è¨Šæ¯å¾Œï¼Œåšé€²ä¸€æ­¥çš„è™•ç†äº†ï¼

### å…ˆåšå€‹å°å„ªåŒ–ï¼šåƒæ•¸åˆ‡å‰²èˆ‡åˆ¤æ–·å°ä¿®æ”¹

åœ¨ [ä½¿ç”¨ discord.js å¿«é€Ÿå»ºç«‹ä¸€å€‹ Discord éª°å­æ©Ÿå™¨äºº](/blog/discordjs-dice-bot/) æ–‡ç« ä¸­ï¼Œç›¸ä¿¡æ‚¨å€‘å·²ç¶“å­¸åˆ°äº†å¦‚ä½•é€²è¡ŒæŒ‡ä»¤åˆæ­¥è™•ç†ï¼Œä½†é¿å…åœ¨å¾ŒçºŒåšæŒ‡ä»¤æ™‚æœƒæœ‰ä¸€äº›å•é¡Œï¼Œé‚„æœ‰æé«˜ç†è§£æ€§ï¼Œåœ¨é€™æˆ‘å»ºè­°åšä¸€äº›å°å„ªåŒ–ï¼š

```js showLineNumbers
client.on("messageCreate", (message) => {
  const prefix = "/"; // å¦‚æœè¦æ”¹æˆè‡ªå·±çš„å‰ç¶´ï¼Œæ”¹"è£¡é¢çš„å­—ä¸²
  if (!message.content.startsWith(prefix) || message.author.bot) return; // ä¿®æ”¹æ­¤è¡Œï¼Œç•¶ç™¼è¨Šæ¯è€…ç‚ºæ©Ÿå™¨äººæ™‚ä¹Ÿä¸åŸ·è¡ŒæŒ‡ä»¤

  const args = message.content.slice(prefix.length).trim().split(/ +/g); // ä¿®æ”¹æ­¤è¡Œï¼Œä¿®æ­£åƒæ•¸åˆ‡å‰²
  //...
});
```

- `message.author.bot`ï¼šé¿å…æ©Ÿå™¨äººäº’ callï¼Œæ‰€ä»¥åŠ ä¸Šé€™å€‹ï¼Œé¿å…æœ‰æ©Ÿå™¨äººåœ¨ç™¼æ­¤æ©Ÿå™¨äººçš„æŒ‡ä»¤è¨Šæ¯æ™‚ï¼Œè§¸ç™¼æ­¤æ©Ÿå™¨äºº
- `split(/ +/g)`ã€`trim()`ï¼šé¦–å…ˆï¼Œç‚ºäº†é¿è¼¸å…¥æŒ‡ä»¤çš„æ ¼å¼ä¸ç¬¦ï¼Œåƒæ•¸èˆ‡åƒæ•¸é–“ç©ºæ ¼è¼¸å…¥æˆå…©å€‹ä»¥ä¸Šï¼Œé€ æˆæŒ‡ä»¤è™•ç†æ™‚åˆ‡å‡ºç©ºåƒæ•¸ï¼Œé€²è€Œå½±éŸ¿å¾ŒçºŒåŸ·è¡Œå•é¡Œï¼Œæ”¹æˆä½¿ç”¨ `split(/ +/g)`ï¼Œç°¡å–®ä¾†è¬›æ„æ€æ˜¯ä»¥ä¸€å€‹æˆ–å¤šå€‹é€£çºŒç©ºæ ¼é€²è¡Œåˆ‡å‰²ã€‚`/ +/g` æ˜¯ [æ­£å‰‡è¡¨é”å¼ï¼ˆRegular Expressionï¼‰](https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Guide/Regular_Expressions)ï¼Œ`trim()` å‰‡æ˜¯å»æ‰æ•´å€‹å­—ä¸²çš„é ­å°¾ç©ºæ ¼ã€‚

### åˆ†æåƒæ•¸

<Adsense />

å…ˆé€²è¡ŒæŒ‡ä»¤åç¨±èˆ‡åƒæ•¸åˆ†é›¢å‹•ä½œã€‚è«‹å°‡å‰›å‰›åˆ‡å‰²åƒæ•¸é‚£è¡Œé€²è¡Œä¿®æ”¹ï¼š

```js
const [command, ...args] = message.content
  .slice(prefix.length)
  .trim()
  .split(/ +/g);
```

`split(/ +/g)` æœƒå‚³å›ä¸€å€‹é™£åˆ—ï¼Œä¸¦å°‡é™£åˆ—ç¬¬ä¸€é …æŒ‡æ´¾çµ¦ commandï¼Œå‰©ä¸‹çš„å…ƒç´ æœƒåœ¨è¢«å…¨éƒ¨æ”¶é›†å¾Œï¼ŒæŒ‡æ´¾çµ¦ args é™£åˆ—ã€‚

`...` ç‚º [åŒ¯é›† / å±•é–‹é‹ç®—å­ (Spread Operator)](https://pjchender.blogspot.com/2017/01/es6-spread-operatorrest-operator.html)ï¼Œåœ¨é€™è£¡æ˜¯åŒ¯é›†ç”¨ï¼Œä¹Ÿå°±æ˜¯æŠŠå‰©ä¸‹çš„é™£åˆ—å…ƒç´ åŒ¯é›†æˆé™£åˆ—ã€‚

### æŒ‡ä»¤æš«å­˜å€å°‹æ‰¾æŒ‡ä»¤ä¸¦åŸ·è¡Œ

è«‹å…ˆå°‡æŒ‡ä»¤ï¼ˆä¾‹å¦‚å…ˆå‰å»ºç«‹çš„ dice æŒ‡ä»¤ï¼‰ç¨‹å¼ç¢¼å…ˆçµ¦è¤‡è£½å¾Œï¼Œè²¼åˆ°å…¶ä»–æª”æ¡ˆå‚™ç”¨ï¼š

![å‚™ä»½æŒ‡ä»¤åˆ°è¨˜äº‹æœ¬](/blog/discordjs-command-handler-1/backup-command.png)

å†ä¾†ï¼Œè«‹å…ˆåˆªé™¤æ•´å€‹ switch åˆ¤æ–·å¼ï¼Œåˆªé™¤å®Œå¾Œæœƒé•·é€™æ¨£ï¼š

```js showLineNumbers
client.on("messageCreate", (message) => {
  const prefix = "/";
  if (!message.content.startsWith(prefix) || message.author.bot) return;

  const [command, ...args] = message.content.slice(prefix.length).split(/ +/g);
});
```

ç„¶å¾Œå†æ’°å¯«å°‹æ‰¾æŒ‡ä»¤ä¸¦åŸ·è¡Œçš„ç¨‹å¼ç¢¼ï¼š

```js showLineNumbers
client.on("messageCreate", (message) => {
  // å»¶çºŒä¸Šæ–¹ç¨‹å¼ç¢¼
  const cmdObject = client.commands.get(command);

  cmdObject?.run(message, args, client);
  // å¦‚æœæœ‰çš„è©±å°±åŸ·è¡ŒæŒ‡ä»¤ç¨‹å¼ç¢¼ï¼Œå¦å‰‡ ? å¾Œé¢å°‡ä¸æœƒè¢«åŸ·è¡Œ
});
```

<Adsense />

`cmdObject?.run()` çš„ `?` [æ˜¯éå¼·åˆ¶ä¸²æ¥é‹ç®—å­ï¼ˆOptional Chainingï¼‰](https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Operators/Optional_chaining)ï¼Œç•¶åŸ·è¡Œ run function å‰ï¼Œæœƒå…ˆç¢ºèªæŒ‡ä»¤ç‰©ä»¶æœ‰æ²’æœ‰è¢«æ‰¾åˆ°ï¼Œå¦‚æœæœ‰æ‰¾åˆ°å°±æœƒåŸ·è¡Œ run functionï¼Œå¦å‰‡ä¸åŸ·è¡Œã€‚ä¹Ÿå°±æ˜¯èªªï¼Œæ­¤è¡Œç¨‹å¼ç¢¼èˆ‡ä¸‹æ–¹é€™æ®µä½œç”¨ç›¸åŒï¼š

```js showLineNumbers
if (cmdObject) {
  // ç¢ºèªæŒ‡ä»¤ç‰©ä»¶æœ‰æ²’æœ‰æ‰¾åˆ°
  cmdObject.run(message, args, client); // æœ‰çš„è©±å°±åŸ·è¡Œ
}
```

## æ’°å¯«æŒ‡ä»¤æª”æ¡ˆ

æ­å–œæ‚¨ï¼æ‚¨å·²ç¶“æˆåŠŸå®ŒæˆæŒ‡ä»¤ç³»çµ±ï¼Œä¸¦ä¸”å¯ä»¥é–‹å§‹æ’°å¯«æŒ‡ä»¤äº†ï¼

è«‹å…ˆåœ¨ `Command` è³‡æ–™å¤¾ä¸‹ï¼Œå»ºç«‹ä¸€å€‹ js æª”æ¡ˆï¼ˆåœ¨æ­¤ä»¥ Dice æŒ‡ä»¤ç•¶ç¯„ä¾‹ï¼Œæ•…å–å `Dice.js`ï¼‰ï¼š
![Vscode å‰µå»ºæŒ‡ä»¤æª”æ¡ˆ](/blog/discordjs-command-handler-1/create-command-file.png)

å†ä¾†ï¼Œå»ºç«‹æŒ‡ä»¤ï¼š

<Warning>æœ‰ç”¨åˆ° discord.js çš„æ±è¥¿è«‹è¨˜å¾—åŒ¯å…¥ï¼ï¼ˆä¾‹å¦‚ï¼š`MessageEmbed`ï¼‰</Warning>

```js showLineNumbers
const { MessageEmbed } = require("discord.js");

module.exports = {
  name: "dice",
  run: async (message, args, bot) => {
    const final = Math.floor(Math.random() * (6 - 1)) + 1;
    const diceEmbed = new MessageEmbed()
      .setTitle(`ğŸ² ä½ å¾—åˆ°äº† ${final}`)
      .setColor("#5865F2");

    return message.reply({
      embeds: [diceEmbed],
    });
  },
};
```

æœ€å¾Œï¼Œå•Ÿå‹•æ©Ÿå™¨äººä¸¦è¼¸å…¥æŒ‡ä»¤ï¼  
![Discord æ©Ÿå™¨äºº æŒ‡ä»¤åŸ·è¡Œ](/blog/discordjs-command-handler-1/command-execute.png)

<Adsense />

è‡³æ­¤ï¼Œæ­å–œæ‚¨å®Œæˆäº†ä¸€å€‹ç°¡æ˜“çš„æŒ‡ä»¤ç³»çµ±ï¼è‹¥æ‚¨æœ‰å•é¡Œï¼Œå¯ä»¥å‰å¾€ [Yeecord æ”¯æ´ç¾¤çµ„](https://discord.gg/yeecord) å°‹æ±‚å”åŠ©ï¼
é †å¸¶ä¸€æï¼Œä¸‹é¢æœ‰ä¸€äº›å»¶ä¼¸ï¼Œå¦‚æœæ‚¨è¦ºå¾—æ‚¨åœ¨é–‹ç™¼ä¸Šæœ‰éœ€è¦ï¼Œå¯ä»¥ç¹¼çºŒé–±è®€ï¼

## å»¶ä¼¸ä¸€ï¼šæ€éº¼å«ï¼Œéƒ½æ˜¯å«æˆ‘ï¼ï¼æŒ‡ä»¤åˆ¥å

å’¦ï¼Ÿæ€éº¼æœ‰äººçœ‹ä¼¼è¼¸å…¥ä¸åŒçš„æŒ‡ä»¤åç¨±ï¼Œä½†å¯¦éš›ä¸Šå»å‘¼å«åˆ°åŒä¸€å€‹æŒ‡ä»¤ï¼Ÿ  
é€™å°±æ˜¯æŒ‡ä»¤åˆ¥åï¼Œä¹Ÿå°±æ˜¯ä¸€å€‹æŒ‡ä»¤å¯ä»¥ç”¨å¤šç¨®æŒ‡ä»¤åç¨±ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥ä»¥å¤šå€‹æŒ‡ä»¤åç¨±å‘¼å«æ­¤æŒ‡ä»¤ï¼

é¦–å…ˆåœ¨ `messageCreate` å…§åšä¸€ä¸‹ä¿®æ”¹ï¼›

```js showLineNumbers
client.on("messageCreate", (message) => {
  // å»¶çºŒä¸Šæ–¹ç¨‹å¼ç¢¼
  const cmdObject =
    client.commands.get(command) ||
    client.commands.find((x) => x.aliases?.includes(command));

  cmdObject?.run(message, args, client);
});
```

æœ€å¾Œå°±å¯ä»¥ç‚ºæŒ‡ä»¤æ–°å¢åˆ¥åäº†ï¼ˆæ­¤ä»¥ Dice æŒ‡ä»¤ç‚ºä¾‹ï¼‰ï¼š

```js showLineNumbers
module.exports = {
  name: "dice",
  aliases: ["doce", "dace"], // <--- åƒé€™æ¨£æ–°å¢æŒ‡ä»¤åˆ¥åï¼ˆç•¶ç„¶é€™è£¡åˆ¥åæ˜¯äº‚å–çš„ï¼‰
  run: async (message, args, bot) => {
    const final = Math.floor(Math.random() * (6 - 1)) + 1;
    const diceEmbed = new MessageEmbed()
      .setTitle(`ğŸ² ä½ å¾—åˆ°äº† ${final}`)
      .setColor("#5865F2");

    return message.reply({
      embeds: [diceEmbed],
    });
  },
};
```

## å»¶ä¼¸äºŒï¼šå¥½æƒ³å·æ‡¶......ï¼æª”æ¡ˆåç¨±ç›´æ¥ç•¶æŒ‡ä»¤åç¨±

<Adsense />

æœ‰äººå¯èƒ½æœƒè¦ºå¾—ï¼šæ¯ä¸€æ¬¡å»ºç«‹æŒ‡ä»¤æ™‚ï¼ŒæŒ‡ä»¤åç¨±åœ¨æŒ‡ä»¤ç¨‹å¼ç¢¼æª”æ¡ˆåç¨±å’ŒæŒ‡ä»¤ç‰©ä»¶è£¡éƒ½è¦è¼¸å…¥ï¼Œå¥½ç…©å–”ï½ï½æœ‰æ²’æœ‰è¾¦æ³•æ¸›å°‘è¼¸å…¥æ¬¡æ•¸å‘€ï¼Ÿ

ç•¶ç„¶æœ‰ï¼Œåœ¨é€™è£¡å°±æ•™å¤§å®¶ä¸€å€‹å·æ‡¶æ–¹æ³•......æª”æ¡ˆåç¨±ç›´æ¥ç•¶æŒ‡ä»¤åç¨±ï¼Œä¹Ÿå°±æ˜¯æŒ‡ä»¤åç¨±æœƒè·Ÿéš¨è‘—æŒ‡ä»¤ç¨‹å¼ç¢¼æª”æ¡ˆåç¨±ç›´æ¥è®Šå‹•ï¼Œå¦‚æœæ‚¨è¦ºå¾—æŒ‡ä»¤åç¨±åœ¨æŒ‡ä»¤ç¨‹å¼ç¢¼æª”æ¡ˆåç¨±å’ŒæŒ‡ä»¤ç‰©ä»¶è£¡éƒ½è¦è¼¸å…¥å¾ˆç…©ï¼Œæˆ–è€…ä½ çœŸçš„å¾ˆæƒ³å·æ‡¶çš„è©±ï¼Œå¯ä»¥å­¸èµ·ä¾†å–”ï¼

æˆ‘å€‘æ‰“é–‹`commandLoader.js`ï¼Œä¿®æ”¹é€™è¡Œå°±å®Œæˆäº†ï¼š

```js showLineNumbers
module.exports = function loadCommands(client, directory) {
  //ä»¥ä¸Šç•¥

  for (const file of files) {
    if (file.isDirectory()) {
      loadCommands(client, `${directory}/${file.name}`);
    } else if (file.name.endsWith(".js")) {
      const cmd = require(`${directory}/${file.name}`);
      client.commands.set(cmd.name ?? file.name.slice(0, -3), cmd); // <---ä¿®æ”¹æ­¤è¡Œ
      if (cmd.aliases) {
        for (const aliase of cmd.aliases) {
          client.aliases.set(aliase, cmd.name);
        }
      }
    }
  }
};
```

- `??` [ç©ºå€¼åˆä½µé‹ç®—å­](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing_operator)ï¼š å¦‚æœå·¦å´ç‚ºç©ºå€¼æˆ–æ˜¯æœªè¢«å®šç¾©ï¼Œé‚£å°‡ä½¿ç”¨å³å´çš„å€¼
- `slice(0, -3)`ï¼šå¾åŸå­—ä¸²ä¸­å–å‡ºä½ç½® 0 åˆ°ä½ç½®ç‚ºå€’æ•¸ 3 ä¹‹é–“çš„å­—ä¸²ï¼ˆä¸å«ä½ç½®ç‚ºå€’æ•¸ 3 çš„å­—å…ƒï¼‰ï¼Œä¸¦ç”¢ç”Ÿæ–°å­—ä¸²ã€‚index åƒæ•¸å¯ç‚ºè² å€¼ï¼Œä»£è¡¨å¾å­—ä¸²æœ€å¾Œé–‹å§‹ï¼Œè‹¥æƒ³äº†è§£æ›´å¤šè«‹åƒè¦‹ [Fooish JavaScript çš„ä»‹ç´¹ï¼ˆä¸­æ–‡ï¼‰](https://www.fooish.com/javascript/string/slice.html) æˆ– [MSDN å®˜æ–¹æ–‡ä»¶ï¼ˆç°¡é«”ä¸­æ–‡ï¼‰](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/slice)

ç„¶å¾Œæ‚¨å°±å¯ä»¥åˆªæ‰æŒ‡ä»¤ç‰©ä»¶ä¸­çš„æŒ‡ä»¤åç¨±ï¼ˆ`name` å±¬æ€§ï¼‰ï¼Œä¸¦ä¸”æŠŠæŒ‡ä»¤ç¨‹å¼ç¢¼æª”æ¡ˆåç¨±ä¿®æ”¹æˆæŒ‡ä»¤åç¨±äº†ï¼

<Adsense />
